## 一、NoSql入门概述

​	我们都知道，关系型数据库mysql是我们常用的数据库，那有了mysql为什么还需要NoSql呢，Nosql又是什么？

### 1.1.关系型数据库的瓶颈

​	在好多年前，一个网站的访问量不大，只需要单个mysql就可以实现功能。但是到了现在，越来越多的人接触互联网，网站的访问量大大增加，致使数据库中数据也越来越多，性能越来越慢，如何解决呢？

- 使用Memcached缓存技术，优化数据库结构与索引

  - 具有弊端：在Memcached中，因为一致性hash来绝句添加或减少缓存服务器导致大量缓存失效

- mysql的主从复制，读写分离。

  - 主从复制：分为主库与从库，添加数据时向主库添加，从库迅速复制这条数据
  - 读写分离：读操作从从库读取，写操作向主库写入
  - 弊端：当数据越来越多时，比如一个库几百万条数据，再怎么优化也没用了。

- mysql集群

  - 分库分表：热点数据和业务相关的放在一些库中，冷数据比如身份证不怎么会变得数据放在一些库中
  - 水平拆分：比如9000万的数据，把1-3000万放到一个库，3001-6000放到一个库，6001-9000放到一个库


​	经过这些优化后，还是有些问题是解决不了的，比如想要存放40g的大数据，放在mysql中是不可能的。大数据下IO压力大，表结构更改困难，数据库恢复非常慢，也是使用mysql开发的主要问题所在。

#### 关系型数据库主要面临的挑战

1. 数据多样性：关系模型不容易组织和管理所有类型多样的数据；
2. 高速并行处理：对传统关系型数据库而言，如何通过大量节点的并行操作实现海量数据的高速处理是一个巨大的挑战；
3. 海量数据分析：在关系型数据库上进行数据的复杂分析可以使用统计分析和数据挖掘软件包(如SPSS、SAS、R等)，但这些软件包处理的数据量受限于内存大小，并行化程度不够。从数据库提取数据注入到分析软件中进行分析将导致大量的数据移动，显然不适合海量数据处理。

### 1.2.NoSql是什么

​	NoSql顾名思义not only sql，意为“不仅仅是SQL”，泛指**非关系型数据库**，主要特点是：**这些类型的数据存储不需要固定的模式，无需多余的操作即可横向扩展。**

### 1.3.NoSql优点

##### 易扩展

​	NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。
	数据之间无关系，这样就非常容易扩展。也无形之间，在架构的层面上带来了可扩展的能力。

##### 高性能

​	NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。这得益于它的无关系性，数据库的结构简单。
	一般MySQL使用Query Cache，每次表的更新Cache就失效，是一种大粒度的Cache，在针对web2.0的交互频繁的应用，Cache性能不高。而NoSQL的Cache是记录级的，是一种细粒度的Cache，所以NoSQL在这个层面上来说就要性能高很多了

##### 丰富的数据类型

​	NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是一个噩梦



## 二、NoSql的数据模型

### 2.1.键值key-value数据库

​	key-value数据库采用key-value数据模型存储和管理数据，key-value存储更加注重对海量数据存取的性能、分布式、扩展性支持，而并**不支持传统关系型数据库的一些特征**，如：Schema、事务、完整SQL查询支持等。key-value存储**利用哈希表维护**key值到具体数据(value)的映射，通过key值可以很方便地对value进行查找。
**key-value数据库的特点**：

- **高性能的简单查询**，复杂操作留给应用层实现；
- 数据模型简单，**易于扩展**。

现有的key value数据库主要有：**Redis**、Tokyo Cabinet、Voldemort、Oracle Berkeley DB、Amazon Dynamo/SimpleDB等。

### 2.2.文档数据库

​	文档数据库以文档存储技术组织和管理数据，每个value又是一个key value的列表，形成循环嵌套的结构，可表示复杂数据结构。文档格式一般采用JSON(JavaScript Object Notation)或者类似于JSON的格式。文档存储模型给予设计者极大的建模灵活性，同时，存储模型和编程模型的一致性方便了面向对象程序开发。
**文档数据库的特点**：

- 架构灵活，没有固定Schema；
- 便于分布式存储海量数据，并提供良好的查询性能。

现有的文档数据库包括：**MongDB**、CouchDB、Riak等。

### 2.3.键列key-column数据库

​	key column存储可看作key value存储模型的一种扩展，一个value包含多列，每列都是一个键值对，这些列可以分组(column family)，呈现出多层嵌套映射(map)的数据结构特点。简单来说，key-column数据模型是通过多层的映射模拟了传统表的存储格式，和key-value模型一样需要通过key进行查找。key-column数据库通常都部署于大规模分布式系统，可方便地添加或删除节点，具有良好的可扩展性。

现有的key-column数据库有：BigTable、**HBase**、Cassandra等。

### 2.4.图数据库

​	图数据库一般用于社交网络这种关系复杂的场景，用于构建关系图谱。

基于Graph(图)存储的系统包括Neo4J、 InfoGrid、Infinite Graph、Hyper Graph DB等。



## 三、CAP原理

- C：强一致性 
- A：高可用性 
- P：分布式容忍性

​	CAP理论就是说在分布式存储系统中，最多只能实现上面的两点。而由于当前的网络硬件肯定会出现延迟丢包等问题，所以**分区容忍性是我们必须需要实现的**。所以我们只能在一致性和可用性之间进行权衡，没有NoSQL系统能同时保证这三点。

 CA 传统Oracle数据库


 AP 大多数网站架构的选择


 CP Redis、Mongodb


 注意：分布式架构的时候必须做出取舍。一致性和可用性之间取一个平衡。多余大多数web应用，其实并不需要强一致性。因此牺牲C换取P，这是目前分布式数据库产品的方向
一致性与可用性的决择


对于web2.0网站来说，关系数据库的很多主要特性却往往无用武之地


数据库事务一致性需求 
　　很多web实时系统并不要求严格的数据库事务，对读一致性的要求很低， 有些场合对写一致性要求并不高。允许实现最终一致性。


数据库的写实时性和读实时性需求
　　对关系数据库来说，插入一条数据之后立刻查询，是肯定可以读出来这条数据的，但是对于很多web应用来说，并不要求这么高的实时性，比方说发一条消息之 后，过几秒乃至十几秒之后，我的订阅者才看到这条动态是完全可以接受的。